<div class="space-y-6">
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-[22px] font-semibold tracking-tight pulse-text">Background Jobs</h1>
      <p class="text-[14px] mt-1 pulse-text-muted">Monitor Sidekiq, Solid Queue, and other job processors</p>
    </div>
    <div class="flex gap-2">
      <% %w[1h 6h 24h 7d].each do |range| %>
        <% active = params[:since] == range || (params[:since].nil? && range == '1h') %>
        <%= link_to range, dashboard_jobs_path(since: range),
            class: "px-3 py-1.5 text-[13px] font-medium rounded-lg #{active ? 'pulse-btn-active' : 'pulse-btn-inactive'}" %>
      <% end %>
    </div>
  </div>

  <!-- Job Stats -->
  <div class="rounded-xl pulse-card">
    <div class="p-5 pulse-card-inner-border" style="border-bottom-width: 1px; border-bottom-style: solid;">
      <h3 class="text-[14px] font-medium pulse-text">Job Performance</h3>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="pulse-table-header">
          <tr class="text-left text-[13px]">
            <th class="p-4 font-medium">Job Class</th>
            <th class="p-4 font-medium">Executions</th>
            <th class="p-4 font-medium">Avg Duration</th>
            <th class="p-4 font-medium">Max Duration</th>
            <th class="p-4 font-medium">Error Rate</th>
          </tr>
        </thead>
        <tbody>
          <% @job_stats.each do |job| %>
            <tr class="hover:opacity-80 pulse-table-row">
              <td class="p-4 text-[14px] font-medium pulse-text"><%= job.name %></td>
              <td class="p-4 text-[13px] pulse-text"><%= number_with_delimiter(job.count) %></td>
              <td class="p-4 font-mono text-[13px] pulse-text"><%= job.avg_duration&.round(0) %>ms</td>
              <td class="p-4 font-mono text-[13px] pulse-text-muted"><%= job.max_duration&.round(0) %>ms</td>
              <td class="p-4">
                <% error_rate = job.count > 0 ? (job.error_count.to_f / job.count * 100).round(2) : 0 %>
                <span class="text-[13px] <%= error_rate > 1 ? 'pulse-error' : 'pulse-success' %>">
                  <%= error_rate %>%
                </span>
              </td>
            </tr>
          <% end %>

          <% if @job_stats.empty? %>
            <tr>
              <td colspan="5" class="p-8 text-center text-[14px] pulse-text-muted">
                No background jobs recorded
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Recent Jobs -->
  <div class="rounded-xl pulse-card">
    <div class="p-5 pulse-card-inner-border" style="border-bottom-width: 1px; border-bottom-style: solid;">
      <h3 class="text-[14px] font-medium pulse-text">Recent Executions</h3>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="pulse-table-header">
          <tr class="text-left text-[13px]">
            <th class="p-4 font-medium">Job</th>
            <th class="p-4 font-medium">Queue</th>
            <th class="p-4 font-medium">Status</th>
            <th class="p-4 font-medium">Duration</th>
            <th class="p-4 font-medium">Time</th>
          </tr>
        </thead>
        <tbody>
          <% @jobs.each do |job| %>
            <tr class="hover:opacity-80 pulse-table-row">
              <td class="p-4">
                <%= link_to job.name, dashboard_trace_path(job.trace_id), class: "text-[14px] font-medium hover:opacity-70 pulse-text" %>
              </td>
              <td class="p-4">
                <span class="inline-block px-2 py-0.5 text-[11px] font-medium rounded pulse-surface-alt pulse-text-secondary">
                  <%= job.queue || 'default' %>
                </span>
              </td>
              <td class="p-4">
                <span class="text-[13px] <%= job.error ? 'pulse-error' : 'pulse-success' %>">
                  <%= job.error ? 'Failed' : 'Completed' %>
                </span>
              </td>
              <td class="p-4 font-mono text-[13px] pulse-text">
                <%= job.duration_ms&.round(0) || '-' %>ms
              </td>
              <td class="p-4 text-[13px] pulse-text-muted">
                <%= time_ago_in_words(job.started_at) %> ago
              </td>
            </tr>
          <% end %>

          <% if @jobs.empty? %>
            <tr>
              <td colspan="5" class="p-8 text-center text-[14px] pulse-text-muted">
                No background jobs found
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
