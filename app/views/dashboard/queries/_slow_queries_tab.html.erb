<div class="space-y-4">
  <!-- Threshold Filter -->
  <div class="flex gap-2 items-center">
    <span class="text-[13px] pulse-text-muted">Threshold:</span>
    <% [[100, '>100ms'], [500, '>500ms'], [1000, '>1s']].each do |value, label| %>
      <% active = @threshold == value %>
      <%= link_to label, dashboard_queries_path(since: params[:since], tab: 'slow', threshold: value),
          class: "px-3 py-1 text-[12px] font-medium rounded-md #{active ? 'pulse-btn-active' : 'pulse-btn-inactive'}" %>
    <% end %>
  </div>

  <!-- Slow Queries Table -->
  <div class="rounded-xl overflow-hidden pulse-card">
    <table class="w-full">
      <thead class="pulse-table-header">
        <tr class="text-left text-[13px]">
          <th class="p-4 font-medium">SQL Query</th>
          <th class="p-4 font-medium">Table</th>
          <th class="p-4 font-medium">Operation</th>
          <th class="p-4 font-medium text-right">Duration</th>
          <th class="p-4 font-medium">Trace</th>
        </tr>
      </thead>
      <tbody>
        <% @slow_queries.each do |query| %>
          <tr class="pulse-table-row">
            <td class="p-4">
              <div class="font-mono text-[12px] leading-relaxed max-w-lg pulse-text">
                <div class="truncate" title="<%= query[:sql] %>"><%= query[:sql] %></div>
              </div>
            </td>
            <td class="p-4 text-[13px] pulse-text-muted"><%= query[:table] || '-' %></td>
            <td class="p-4">
              <span class="px-2 py-0.5 rounded text-[11px] font-medium uppercase pulse-operation-badge"
                    data-operation="<%= query[:operation] || 'QUERY' %>"
                    style="<%= case query[:operation]
                      when 'SELECT' then 'background: rgba(59, 130, 246, 0.15); color: #3B82F6;'
                      when 'INSERT' then 'background: rgba(16, 185, 129, 0.15); color: #10B981;'
                      when 'UPDATE' then 'background: rgba(245, 158, 11, 0.15); color: #F59E0B;'
                      when 'DELETE' then 'background: rgba(239, 68, 68, 0.15); color: #EF4444;'
                      else 'background: var(--pulse-surface-alt); color: var(--pulse-text-secondary);'
                    end %>">
                <%= query[:operation] || 'QUERY' %>
              </span>
            </td>
            <td class="p-4 text-right">
              <span class="font-mono text-[13px] font-medium <%= query[:duration_ms] >= 500 ? 'pulse-error' : 'pulse-warning' %>">
                <%= query[:duration_ms].round(1) %>ms
              </span>
            </td>
            <td class="p-4">
              <%= link_to query[:trace_name], dashboard_trace_path(query[:trace_id], since: params[:since]),
                  class: "text-[13px] hover:underline",
                  style: "color: var(--pulse-chart-primary);" %>
            </td>
          </tr>
        <% end %>

        <% if @slow_queries.empty? %>
          <tr>
            <td colspan="5" class="p-8 text-center text-[14px] pulse-text-muted">
              <div class="text-[20px] mb-2">âœ“</div>
              No queries slower than <%= @threshold %>ms found
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
