<div class="grid grid-cols-3 gap-6">
  <!-- Frequent Queries -->
  <div class="col-span-2 space-y-4">
    <h2 class="text-[16px] font-semibold pulse-text">Query Patterns by Frequency</h2>
    <div class="rounded-xl overflow-hidden pulse-card">
      <table class="w-full">
        <thead class="pulse-table-header">
          <tr class="text-left text-[13px]">
            <th class="p-4 font-medium">Query Pattern</th>
            <th class="p-4 font-medium text-right">Count</th>
            <th class="p-4 font-medium text-right">Avg Time</th>
            <th class="p-4 font-medium text-right">Total Time</th>
          </tr>
        </thead>
        <tbody>
          <% @frequent_queries.each_with_index do |query, index| %>
            <tr class="pulse-table-row">
              <td class="p-4">
                <div class="flex items-center gap-3">
                  <span class="w-6 h-6 flex items-center justify-center rounded-full text-[11px] font-medium <%= index < 3 ? 'pulse-warning-badge' : 'pulse-surface-alt pulse-text-secondary' %>">
                    <%= index + 1 %>
                  </span>
                  <div class="flex-1">
                    <div class="font-mono text-[12px] leading-relaxed max-w-md truncate pulse-text" title="<%= query[:normalized_sql] %>">
                      <%= query[:normalized_sql] %>
                    </div>
                    <div class="text-[11px] mt-0.5 pulse-text-muted">
                      <span class="uppercase"><%= query[:operation] || 'QUERY' %></span>
                      <% if query[:table] %>
                        · <%= query[:table] %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </td>
              <td class="p-4 text-[13px] text-right font-medium pulse-text"><%= number_with_delimiter(query[:count]) %></td>
              <td class="p-4 text-[13px] text-right font-mono pulse-text-muted"><%= query[:avg_duration_ms] %>ms</td>
              <td class="p-4 text-[13px] text-right font-mono pulse-text-muted"><%= query[:total_duration_ms].round(0) %>ms</td>
            </tr>
          <% end %>

          <% if @frequent_queries.empty? %>
            <tr>
              <td colspan="4" class="p-8 text-center text-[14px] pulse-text-muted">
                No query patterns found
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Table Breakdown -->
  <div class="space-y-4">
    <h2 class="text-[16px] font-semibold pulse-text">By Table</h2>
    <div class="rounded-xl p-4 space-y-3 pulse-card">
      <% @table_breakdown.first(10).each do |table| %>
        <div>
          <div class="flex justify-between items-center mb-1">
            <span class="text-[13px] font-medium pulse-text"><%= table[:table] %></span>
            <span class="text-[12px] font-mono pulse-text-muted"><%= number_with_delimiter(table[:count]) %></span>
          </div>
          <% max_count = @table_breakdown.first[:count] rescue 1 %>
          <% percentage = (table[:count].to_f / max_count * 100).round %>
          <div class="h-1.5 rounded-full pulse-breakdown-bg">
            <div class="h-full rounded-full" style="background: var(--pulse-chart-primary); width: <%= percentage %>%;"></div>
          </div>
          <div class="text-[11px] mt-0.5 pulse-text-muted">
            Avg: <%= table[:avg_duration_ms] %>ms · Total: <%= (table[:total_duration_ms] / 1000).round(1) %>s
          </div>
        </div>
      <% end %>

      <% if @table_breakdown.empty? %>
        <div class="text-center text-[14px] py-4 pulse-text-muted">
          No table data available
        </div>
      <% end %>
    </div>
  </div>
</div>
